---
title: "[ GraphQL ] ë°ì´í„° CRUDì—°ìŠµ"
author: <author_id>
categories: [ GraphQL,  Study]
tags: [ GraphQL]
math: true
toc: true
mermaid: true
image: /images/backgrounds/graphql.png
---

## ë””ë ‰í† ë¦¬ ê²½ë¡œ
+ ### My-Project/graphql-server
  + #### My-Project/graphql-server/index.js

    ```javascript
    const { ApolloServer, gql } = require('apollo-server');
    const { readFileSync, writeFileSync } = require('fs');
    const { join } = require('path');

    // The GraphQL schema
    const typeDefs = gql`
      type Query {
        "A simple type for getting started!"
        hello: String
        books: [Book]
        book(bookId: Int): Book
      }
      type Mutation {
        addBook(title: String, message: String, author: String, url: String): Book
        editBook(
          bookId: Int
          title: String
          message: String
          author: String
          url: String
        ): Book
        deleteBook(bookId: Int): Book
      }
      type Book {
        bookId: Int
        title: String
        message: String
        author: String
        url: String
      }
    `;

      // A map of functions which return data for the schema.
      const resolvers = {
        Query: {
          hello: () => 'Hello World',
          books: () => {
            return JSON.parse(readFileSync(join(__dirname, 'books.json')).toString());
          },
          book: (parent, args, context, info) => {
            const books = JSON.parse(
              readFileSync(join(__dirname, 'books.json')).toString()
            );
            return books.find((book) => book.bookId === args.bookId);
          },
        },
        Mutation: {
          addBook: (parent, args, context, info) => {
            const books = JSON.parse(
              readFileSync(join(__dirname, 'books.json')).toString()
            );
            const maxId = Math.max(...books.map((book) => book.bookId));
            const newBook = { bookId: maxId + 1, ...args };
            writeFileSync(
              join(__dirname, 'books.json'),
              JSON.stringify([...books, newBook])
            );
            return newBook;
          },
          editBook: (parent, args, context, info) => {
            const books = JSON.parse(
              readFileSync(join(__dirname, 'books.json')).toString()
            );
            const newBooks = books.map((book) => {
              if (book.bookId === args.bookId) {
                return args;
              } else {
                return book;
              }
            });
            writeFileSync(join(__dirname, 'books.json'), JSON.stringify(newBooks));
            return args;
          },
          deleteBook: (parent, args, context, info) => {
            const books = JSON.parse(
              readFileSync(join(__dirname, 'books.json')).toString()
            );
            const deletedBook = books.find((book) => book.bookId === args.bookId);
            const newBooks = books
              .filter((book) => book.bookId !== args.bookId)
              .map((book, index) => {
                book.bookId = index;
                return { ...book };
              });
            writeFileSync(join(__dirname, 'books.json'), JSON.stringify(newBooks));
            return deletedBook;
          },
        },
      };

      const server = new ApolloServer({
        typeDefs,
        resolvers,
        playground: true,
      });

      server.listen().then(({ url }) => {
        console.log(`ğŸš€ Server ready at ${url}`);
      });

    ```

## íŠ¹ì • ë°ì´í„° ì¡°íšŒ

- #### bookIdë¥¼ ë°›ì•„ì˜¤ëŠ” ì¿¼ë¦¬ ì‘ì„±
  ```javascript
  const typeDefs = gql`
    type Query {
      hello: String
      books:[Book]
      
      // bookIdë¥¼ ë°›ì•„ì˜¤ëŠ” ì¿¼ë¦¬
      book(bookId : Int) : Book
      
    },
    type Book {
      bookId: Int,
      title: String,
      message: String,
      author: String,
      url: String
    }
  `;
  ```
- #### bookIdë¥¼ ë°›ì•„ ë°ì´í„°ë¥¼ ì°¾ì•„ ë¦¬í„´ í•˜ëŠ” í•¨ìˆ˜ ì‘ì„±
  ```javascript
  const resolvers = {
    Query: {
      hello: () => 'Hello World',
      books: () => {
        return JSON.parse(
          readFileSync(join(__dirname, 'books.json')).toString()
        );
      },
      book: (parent, args, context, info) => {
        const books = JSON.parse(
          readFileSync(join(__dirname, 'books.json')).toString()
        );
        return books.find((book) => book.bookId === args.bookId);
      },
    },
  };
  ```

## ë°ì´í„° ì¶”ê°€

- #### ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ì¿¼ë¦¬ ì‘ì„±
  ```javascript
  const typeDefs = gql`
    type Mutation {
      addBook(title: String, message: String, author: String, url: String): Book
    }
  `;
  ```
- #### ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ê¸°ì¡´ì˜ bookId +1ì„ ê°€ì§„ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ ê°ì²´ì— ì¶”ê°€ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±.
  ```javascript
  const resolvers = {
    Mutation: {
      addBook: (parent, args, context, info) => {
        const books = JSON.parse(
          readFileSync(join(__dirname, 'books.json')).toString()
        );
        const maxId = Math.max(...books.map((book) => book.bookId));
        const newBook = { bookId: maxId + 1, ...args };
        writeFileSync(
          join(__dirname, 'books.json'),
          JSON.stringify([...books, newBook])
        );
        return newBook;
      },
    },
  };
  ```

## íŠ¹ì • ë°ì´í„° ì‚­ì œ

- #### íŠ¹ì • ë°ì´í„°ì˜ bookIdë¥¼ ë°›ì•„ì˜¤ëŠ” ì¿¼ë¦¬ ì‘ì„±
  ```javascript
  const typeDefs = gql`
    type Mutation {
      deleteBook(bookId: Int): Book
    }
  `;
  ```
- #### bookId ë°ì´í„°ë¥¼ ë°›ì•„ì™€ ë°›ì•„ì˜¨ bookId ì™€ ê°™ì€ bookId ë¥¼ ê°€ì§„ ê°ì²´ ì‚­ì œ
  ```javascript
  const resolvers = {
    Mutation: {
      deleteBook: (parent, args, context, info) => {
        const books = JSON.parse(
          readFileSync(join(__dirname, 'books.json')).toString()
        );
        // ê°ì²´ ë°°ì—´ booksë¥¼ find í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë°›ì•„ì˜¨ bookIdì™€ ê°™ì€ ë°ì´í„°ë¥¼ ì°¾ì•„ deletedBookì— í• ë‹¹
        const deletedBook = books.find((book) => book.bookId === args.bookId);
        // ê°ì²´ ë°°ì—´ booksë¥¼ filter í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ë°›ì•„ì˜¨ bookIdì™€ ê°™ì€ ë°ì´í„°ë¥¼ ê±¸ëŸ¬ newBooksì— í• ë‹¹
        // í• ë‹¹ëœ ë°ì´í„°ë“¤ì˜ bookIdë¥¼ 0ë¶€í„° ìˆœì„œëŒ€ë¡œ ì¬í• ë‹¹
        const newBooks = books
          .filter((book) => book.bookId !== args.bookId)
          .map((book, index) => {
            book.bookId = index;
            return { ...book };
          });
        writeFileSync(join(__dirname, 'books.json'), JSON.stringify(newBooks));
        // ì‚­ì œí•œ ë°ì´í„°ë¥¼ ë°˜í™˜
        return deletedBook;
      },
    },
  };
  ```

## [GitHub ë§í¬](https://github.com/seungjin-le/React_GraphQL)
